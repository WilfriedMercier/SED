
<!DOCTYPE html>

<html lang="en">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<title>SED.sed | Resolved SED-fitting wrapper 0.5 documentation</title>
<link href="../../_static/pygments.css" rel="stylesheet"/>
<link href="../../_static/theme.313ea551d1799b2102b1.css" rel="stylesheet"/>
<link href="../../_static/plot_directive.css" rel="stylesheet"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="../../genindex.html" rel="index" title="Index"/>
</head>
<body class="antialiased text-gray">
<div class="h-screen xl:grid xl:grid-layout" data-action="keydown@window-&gt;search#focus" data-controller="sidebar search" id="page">
<a class="block text-xl bg-white py-4 z-20 absolute top-0 h-18 inset-x-0 text-center transform -translate-y-full focus:translate-y-0 focus:outline-none transition-transform duration-75" href="#sed-sed" title="Skip navigation links">Skip to content</a>
<header class="grid-area-header z-10 h-14 sm:h-18">
<div class="bg-gray-dark shadow-md flex items-center h-full xl:px-2 relative"><div class="flex items-center">
<button class="xl:hidden h-14 w-14 sm:h-18 sm:w-18 leading-14 sm:leading-18 text-gray-100 hover:bg-gray-700 hover:text-brand focus:outline-none focus:bg-gray-700 focus:text-brand" data-action="sidebar#open" data-sidebar-target="hamburger">
<span class="sr-only">Open navigation menu</span>
<svg aria-hidden="true" class="fill-current h-8 w-8" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg>
</button><a aria-label="Back to homepage" class="hover:bg-gray-700 focus:bg-gray-700 focus:outline-none tooltipped tooltipped-sw" href="../../index.html"><span class="hidden lg:inline-block shrink-0 font-medium text-gray-100 mx-5 leading-14 sm:leading-18 tracking-wider">Resolved SED-fitting wrapper 0.5 documentation</span>
</a></div><div class="flex justify-end items-center flex-1"><form action="../../search.html" class="flex print:hidden justify-between items-center leading-14 sm:leading-18 md:ml-4 bg-gray-dark text-gray-300 focus-within:bg-gray-50 focus-within:text-gray-800 focus-within:absolute focus-within:inset-x-0 focus-within:top-0 md:focus-within:w-full md:focus-within:static" data-action="click-&gt;search#focusSearchInput" id="searchbox" method="get">
<button aria-label="Get search results" class="text-inherit h-14 w-14 sm:h-18 sm:w-18" tabindex="-1">
<svg aria-hidden="true" class="fill-current stroke-current h-8 w-8" stroke-width="0.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
</button>
<input aria-label="Search the docs" class="pr-2 bg-transparent text-inherit focus:outline-none w-0 md:w-auto focus:w-full transition-all duration-100" data-search-target="searchInput" id="search-input" name="q" placeholder="Search the docs" type="search"/>
</form><div class="shrink-0"><a class="h-14 sm:h-18 inline-block leading-14 sm:leading-18 text-gray-100 bg-transparent tracking-wide font-medium hover:text-brand focus:bg-gray-700 focus:outline-none hover:no-underline focus:text-brand px-4" href="../../https%3A//github.com/WilfriedMercier/SED.html">GitHub</a></div></div>
</div>
</header>
<aside class="grid-area-sidebar h-full fixed xl:relative inset-y-0 left-0 z-20 xl:z-0 print:hidden overflow-y-auto transition-all transform transform-gpu -translate-x-full opacity-0 duration-300 xl:translate-x-0 xl:opacity-100" data-sidebar-target="sidebar">
<nav class="h-full overflow-y-auto bg-white text-gray-600 pt-8 flex flex-col" role="navigation">
<div class="nav-toc flex-1 pl-6"><ul>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../setup.html">Installation and setup</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../setup.html#required-dependencies">Required dependencies</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../setup.html#sed-fitting-codes-installation">SED fitting codes installation</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../setup.html#id1">LePhare</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../setup.html#id2">Cigale</a></div></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/index.html">Tutorial introduction</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/lephare.html">LePhare</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/lephare.html#step-1-building-filter-and-filterlist-objects">Step 1: Building <code class="xref py py-class docutils literal notranslate">Filter</code> and <code class="xref py py-class docutils literal notranslate">FilterList</code> objects</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/lephare.html#step-2-generate-a-lepharecat-object">Step 2: Generate a <code class="xref py py-class docutils literal notranslate">LePhareCat</code> object</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/lephare.html#step-3-create-a-lepharesed-object">Step 3: Create a <code class="xref py py-class docutils literal notranslate">LePhareSED</code> object</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/lephare.html#step-4-run-the-sed-fitting">Step 4: Run the SED fitting</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/lephare.html#step-4-bis-extract-output-data-from-output-file">Step 4-bis: Extract output data from output file</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/lephare.html#step-5-generate-a-resolved-map">Step 5: Generate a resolved map</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/cigale.html">Cigale</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/index.html#nomenclature">Nomenclature</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/index.html#pre-processing-step">Pre-processing step</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/index.html#step-1-building-filter-and-filterlist-objects">Step 1: Building <code class="xref py py-class docutils literal notranslate">Filter</code> and <code class="xref py py-class docutils literal notranslate">FilterList</code> objects</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/index.html#step-2-generate-a-catalogue-object">Step 2: Generate a <code class="xref py py-class docutils literal notranslate">Catalogue</code> object</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/index.html#step-3-create-a-sed-object">Step 3: Create a <code class="xref py py-class docutils literal notranslate">SED</code> object</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/index.html#step-4-run-the-sed-fitting">Step 4: Run the SED fitting</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../tutorial/index.html#step-5-produce-a-resolved-map">Step 5: Produce a resolved map</a></div></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../examples/example1.html">1. Resolved stellar mass map with LePhare</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../examples/example2.html">2. Resolved SFR map from an already existing LePhare output file</a></div></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">―――――――――――――――</span></p>
<ul>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/index.html">API</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/catalogues.html">Catalogue classes</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/filters.html">Filter classes</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/misc/index.html">Miscellaneous</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/misc/enum.html">Enumeration classes</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/misc/misc.html">Miscellaneous classes and functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/misc/properties.html">Property classes</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/outputs.html">SED fitting code output classes</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../API/sed.html">SED classes</a></div></li>
</ul>
</li>
</ul>
</div>
<button class="text-4xl text-gray-800 p-4 bottom-0 hover:text-brand xl:hidden focus:text-brand self-center" data-action="" title="Close navigation menu">
<span class="sr-only">Close navigation menu</span>
<svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</aside>
<main class="px-10 xl:ml-fluid grid-area-main overflow-y-auto flex flex-col h-full mx-0 md:mx-auto xl:mr-0" data-action="scroll-&gt;scroll#showButton" data-controller="scroll"><nav aria-label="breadcrumbs" class="print:hidden mt-12 text-sm text-gray-light" role="navigation">
<a class="text-gray-light text-sm hover:text-gray-dark font-medium focus:text-gray-dark" href="../../index.html">Resolved SED-fitting wrapper 0.5 documentation</a>
<span class="mr-1">/</span><a class="text-gray-light text-sm hover:text-gray-dark" href="../index.html">Module code</a>
<span class="mr-1">/</span><span aria-current="page">SED.sed</span>
</nav>
<article class="flex-1" role="main">
<h1>Source code for SED.sed</h1><div class="highlight"><pre>
<code><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sa">r</span><span class="sd">"""</span>
<span class="sd">.. codeauthor:: Hugo Plombat - LUPM &lt;hugo.plombat@umontpellier.fr&gt; &amp; Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>

<span class="sd">Utilties related to generating 2D mass and SFR maps using LePhare SED fitting codes.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>          <span class="k">as</span>     <span class="nn">opath</span>

<span class="kn">from</span>   <span class="nn">distutils.spawn</span>  <span class="kn">import</span> <span class="n">find_executable</span>
<span class="kn">from</span>   <span class="nn">copy</span>             <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span>   <span class="nn">typing</span>           <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span>   <span class="nn">io</span>               <span class="kn">import</span> <span class="n">TextIOBase</span>
<span class="kn">from</span>   <span class="nn">abc</span>              <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span>   <span class="nn">textwrap</span>         <span class="kn">import</span> <span class="n">dedent</span><span class="p">,</span> <span class="n">indent</span>
<span class="kn">from</span>   <span class="nn">functools</span>        <span class="kn">import</span> <span class="n">partialmethod</span>

<span class="kn">from</span>   <span class="nn">.outputs</span>         <span class="kn">import</span> <span class="n">LePhareOutput</span><span class="p">,</span> <span class="n">CigaleOutput</span>
<span class="kn">from</span>   <span class="nn">.catalogues</span>      <span class="kn">import</span> <span class="n">LePhareCat</span><span class="p">,</span> <span class="n">CigaleCat</span>
<span class="kn">from</span>   <span class="nn">.coloredMessages</span> <span class="kn">import</span> <span class="n">errorMessage</span><span class="p">,</span> <span class="n">warningMessage</span>
<span class="kn">from</span>   <span class="nn">.misc.properties</span> <span class="kn">import</span> <span class="n">IntProperty</span><span class="p">,</span> <span class="n">FloatProperty</span><span class="p">,</span> <span class="n">StrProperty</span><span class="p">,</span> <span class="n">ListIntProperty</span><span class="p">,</span> <span class="n">ListFloatProperty</span><span class="p">,</span> <span class="n">ListStrProperty</span><span class="p">,</span> <span class="n">PathProperty</span><span class="p">,</span> <span class="n">ListPathProperty</span><span class="p">,</span> <span class="n">EnumProperty</span><span class="p">,</span> <span class="n">BoolProperty</span>
<span class="kn">from</span>   <span class="nn">.misc.enum</span>       <span class="kn">import</span> <span class="n">MagType</span><span class="p">,</span> <span class="n">YESNO</span><span class="p">,</span> <span class="n">ANDOR</span><span class="p">,</span> <span class="n">LePhareOutputParam</span>
<span class="kn">from</span>   <span class="nn">.misc</span>            <span class="kn">import</span> <span class="n">cigaleModules</span> <span class="k">as</span> <span class="n">cigmod</span>
                         
     
<span class="n">ERROR</span>   <span class="o">=</span> <span class="n">errorMessage</span><span class="p">(</span><span class="s1">'Error:'</span><span class="p">)</span>
<span class="n">WARNING</span> <span class="o">=</span> <span class="n">warningMessage</span><span class="p">(</span><span class="s1">'Warning:'</span><span class="p">)</span>

<div class="viewcode-block" id="SED"><a class="viewcode-back" href="../../API/sed.html#SED.sed.SED">[docs]</a><span class="k">class</span> <span class="nc">SED</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Abstract SED object used for inheritance.</span>
<span class="sd">    '''</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''Init SED oject.'''</span>
        
        <span class="c1">#: Log file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Run the SED fitting code.</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span>
    
<div class="viewcode-block" id="SED.appendLog"><a class="viewcode-back" href="../../API/sed.html#SED.sed.SED.appendLog">[docs]</a>    <span class="k">def</span> <span class="nf">appendLog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">TextIOBase</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Append a new text line to the log file.</span>
<span class="sd">        </span>
<span class="sd">        :param text: text to append</span>
<span class="sd">        :type text: :python:`str`</span>
<span class="sd">        :param f: file-like opened obect to write into</span>
<span class="sd">        :type f: `TextIOBase`_</span>
<span class="sd">        </span>
<span class="sd">        :param verbose: (**Optional**) whether to also print the log line or not</span>
<span class="sd">        :type verbose: :python:`bool`</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError:</span>
<span class="sd">            </span>
<span class="sd">            * if **text** is not of type :python:`str`</span>
<span class="sd">            * if **verbose** is not of type :python:`bool`</span>
<span class="sd">            * if **f** is not of type `TextIOBase`_</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'log text has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type str.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'verbose parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type bool.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">TextIOBase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'f parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type TextIOBase.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="SED.startProcess"><a class="viewcode-back" href="../../API/sed.html#SED.sed.SED.startProcess">[docs]</a>    <span class="k">def</span> <span class="nf">startProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">log</span><span class="p">:</span> <span class="n">TextIOBase</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>

<span class="sd">        Start a process.</span>
<span class="sd">        </span>
<span class="sd">        :param commands: list of commands to use with Popen</span>
<span class="sd">        :type commands: :python:`list[str]`</span>
<span class="sd">        </span>
<span class="sd">        :param log: (**Optional**) oppened log file</span>
<span class="sd">        :type log: `TextIOBase`_</span>
<span class="sd">        :param errMsg: (**Optional**) message error to show if the process failed</span>
<span class="sd">        :type errMsg: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: </span>
<span class="sd">            </span>
<span class="sd">            * if **errMsg** is not of type :python:`str`</span>
<span class="sd">            * if **commands** is not of type :python:`list`</span>
<span class="sd">            * if one of the commands in **commands** is not of type :python:`str`</span>
<span class="sd">            </span>
<span class="sd">        :raises OSError: if the first command in **commands** is not a valid file/script name</span>
<span class="sd">        :raises ValueError: if **log** is :python:`None`</span>
<span class="sd">        '''</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errMsg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'errMsg parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type str.'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'commands parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type list.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'one of the commands does not have the type str.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">log</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'You need to provide a log file-like object.'</span><span class="p">)</span>
            
        <span class="n">command</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">find_executable</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'script/excutable </span><span class="si">{</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> (expanded as </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s1">) not found.'</span><span class="p">)</span>

        <span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>

        <span class="k">with</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">appendLog</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span>
                
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="CigaleSED"><a class="viewcode-back" href="../../API/sed.html#SED.sed.CigaleSED">[docs]</a><span class="k">class</span> <span class="nc">CigaleSED</span><span class="p">(</span><span class="n">SED</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Implements Cigale SED object.</span>
<span class="sd">    </span>
<span class="sd">    .. important:</span>
<span class="sd">        </span>
<span class="sd">        If you want to consider the uncertainties, you must specify it for each band. That is, the following line will not consider uncertainties</span>
<span class="sd">        </span>
<span class="sd">        :python:`sedobj = CigaleSED('someID', ['F160W', 'F125W', 'F850LP'])`</span>
<span class="sd">        </span>
<span class="sd">        On the other hand, the follwing line will consider the uncertainties for the first and last filters (F160W and F850LP) only</span>
<span class="sd">        </span>
<span class="sd">        :python:`sedobj = CigaleSED('someID', ['F160W', 'F125W', 'F850LP'], uncertainties=[True, False, True])`</span>
<span class="sd">    </span>
<span class="sd">    :param ID: an identifier used to name the output files created during the SED fitting process</span>
<span class="sd">    :param filters: filters to use for the SED fitting</span>
<span class="sd">    :type filters: :python:`list`</span>
<span class="sd">    </span>
<span class="sd">    :param uncertainties: (**Optional**) list of bool to specify which uncertainties to use. If provided, it must be same length as **filters**.</span>
<span class="sd">    :type uncertainties: :python:`list[bool]`</span>
<span class="sd">    :param SFH: (**Optional**) star formation history modules to use. **At least one module must be given.**</span>
<span class="sd">    :type SFH: :python:`list` [:py:class:`~.cigmod.SFHmodule`]</span>
<span class="sd">    :param SSP: (**Optional**) single stellar population modules to use. **At least one module must be given.**</span>
<span class="sd">    :type SSP: :python:`list` [:py:class:`~.cigmod.SSPmodule`]</span>
<span class="sd">    :param nebular: (**Optional**) nebular emission modules to use. Empty list means no module is used.</span>
<span class="sd">    :type nebular: :python:`list` [:py:class:`~.cigmod.NEBULARmodule`]</span>
<span class="sd">    :param attenuation: (**Optional**) dust attenuation modules to use. Empty list means no module is used.</span>
<span class="sd">    :type attenuation: :python:`list` [:py:class:`~.cigmod.ATTENUATIONmodule`]</span>
<span class="sd">    :param dust: (**Optional**) dust emission modules to use. Empty list means no module is used.</span>
<span class="sd">    :type dust: :python:`list` [:py:class:`~.cigmod.DUSTmodule`]</span>
<span class="sd">    :param agn: (**Optional**) agn modules to use. Empty list means no module is used.</span>
<span class="sd">    :type agn: :python:`list` [:py:class:`cigmod.AGNmodule`]</span>
<span class="sd">    :param radio: (**Optional**) synchrotron radiation modules to use. Empty list means no module is used.</span>
<span class="sd">    :type radio: :python:`list` [:py:class:`cidmog.AGNmodule`]</span>
<span class="sd">    :param restframe: (**Optional**) restframe parameters modules to use. Empty list means no module is used.</span>
<span class="sd">    :type restframe: :python:`list` [:py:class:`cigmod.RESTFRAMEmodule`]</span>
<span class="sd">    :param redshifting: (**Optional**) redshifitng+IGM modules to use. Empty list means no module is used.</span>
<span class="sd">    :type redshifting: :python:`list` [:py:class:`cigmod.REDSHIFTINGmodule`]</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError: if any of the keyword parameters if not a :python:`list`</span>
<span class="sd">    :raises ValueError: if no **SFH**, **SSP** and **redshifting** modules are provided</span>
<span class="sd">    '''</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                 <span class="n">uncertainties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>         <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">SFH</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">SFHmodule</span><span class="p">]</span>                 <span class="o">=</span> <span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">SFH2EXPmodule</span><span class="p">()],</span>
                 <span class="n">SSP</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">SSPmodule</span><span class="p">]</span>                 <span class="o">=</span> <span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">BC03module</span><span class="p">()],</span>
                 <span class="n">nebular</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">NEBULARmodule</span><span class="p">]</span>         <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">attenuation</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">ATTENUATIONmodule</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">dust</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">DUSTmodule</span><span class="p">]</span>               <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">agn</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">AGNmodule</span><span class="p">]</span>                 <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">radio</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">RADIOmodule</span><span class="p">]</span>             <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">restframe</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">RESTFRAMEmodule</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">redshifting</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">REDSHIFTmodule</span><span class="p">]</span>    <span class="o">=</span> <span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">REDSHIFTmodule</span><span class="p">()],</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'parameter filters has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a list.'</span><span class="p">)</span>
        
        <span class="c1"># If no uncertainty is given, we do not use the filters</span>
        <span class="k">if</span> <span class="n">uncertainties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">uncertainties</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">uncertainties</span><span class="p">,</span> <span class="n">SFH</span><span class="p">,</span> <span class="n">SSP</span><span class="p">,</span> <span class="n">nebular</span><span class="p">,</span> <span class="n">attenuation</span><span class="p">,</span> <span class="n">dust</span><span class="p">,</span> <span class="n">agn</span><span class="p">,</span> <span class="n">radio</span><span class="p">,</span> <span class="n">restframe</span><span class="p">,</span> <span class="n">redshifting</span><span class="p">],</span> 
                             <span class="p">[</span><span class="s1">'uncertainties'</span><span class="p">,</span><span class="s1">'SFH'</span><span class="p">,</span> <span class="s1">'SSP'</span><span class="p">,</span> <span class="s1">'nebular'</span><span class="p">,</span> <span class="s1">'attenuation'</span><span class="p">,</span> <span class="s1">'dust'</span><span class="p">,</span> <span class="s1">'agn'</span><span class="p">,</span> <span class="s1">'radio'</span><span class="p">,</span> <span class="s1">'restframe'</span><span class="p">,</span> <span class="s1">'redshifting'</span><span class="p">]):</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'parameter </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a list.'</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uncertainties</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'uncertainties has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">uncertainties</span><span class="p">)</span><span class="si">}</span><span class="s1"> and filters has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="si">}</span><span class="s1"> but they must have the same length.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uncertainties</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'one of the values in uncertainties is not a bool.'</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SFH</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'at least one SFH module must be provided'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SSP</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'at least one SSP module must be provided'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">redshifting</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'at least one redshifting module must be provided'</span><span class="p">)</span>
            
        <span class="c1">#: Will be used to generate a custom directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">Any</span>                               <span class="o">=</span> <span class="n">ID</span>
        
        <span class="c1">#: Filters to use for the SED fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span> <span class="n">ListStrProperty</span>              <span class="o">=</span> <span class="n">ListStrProperty</span><span class="p">(</span><span class="n">filters</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">filt</span><span class="si">}</span><span class="s1">_err'</span> <span class="k">for</span> <span class="n">filt</span><span class="p">,</span> <span class="n">uncertainty</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">uncertainties</span><span class="p">)</span> <span class="k">if</span> <span class="n">uncertainty</span><span class="p">])</span>
        
        <span class="c1"># For now we set this parameter to an empty str and we only allow pdf_analysis method (no savefluxes)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>                              <span class="o">=</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">'pdf_analysis'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_file</span>                       <span class="o">=</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span>                            <span class="o">=</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
        
        <span class="c1">#: SFH modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SFH</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">SFHmodule</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">SFH</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">SFHmodule</span><span class="p">)</span> 
        
        <span class="c1">#: SSP modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SSP</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">SSPmodule</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">SSP</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">SSPmodule</span><span class="p">)</span>
        
        <span class="c1">#: Nebular emission modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nebular</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">NEBULARmodule</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">nebular</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">NEBULARmodule</span><span class="p">)</span>
        
        <span class="c1">#: Dust attenuation modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attenuation</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">ATTENUATIONmodule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">attenuation</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">ATTENUATIONmodule</span><span class="p">)</span>
        
        <span class="c1">#: Dust emission modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">DUSTmodule</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">dust</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">DUSTmodule</span><span class="p">)</span>
        
        <span class="c1">#: AGN modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agn</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">AGNmodule</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">agn</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">AGNmodule</span><span class="p">)</span>
        
        <span class="c1">#: Synchrotron radiation modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">RADIOmodule</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">radio</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">RADIOmodule</span><span class="p">)</span>
        
        <span class="c1">#: Rest-frame parameters modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restframe</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">RESTFRAMEmodule</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">restframe</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">RESTFRAMEmodule</span><span class="p">)</span>
        
        <span class="c1">#: Redshifting modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redshifting</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">REDSHIFTmodule</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">redshifting</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">REDSHIFTmodule</span><span class="p">)</span>
        
        <span class="c1">#: Modules names list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moduleNames</span><span class="p">:</span> <span class="n">ListStrProperty</span>           <span class="o">=</span> <span class="n">ListStrProperty</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SFH</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSP</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nebular</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">attenuation</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">agn</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">restframe</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshifting</span><span class="p">])</span>
        
        <span class="c1">#: Modules parameters in str format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modulesStr</span><span class="p">:</span> <span class="nb">str</span>                        <span class="o">=</span> <span class="s1">''</span>
        
        <span class="c1">#: Modules spec parameters in str format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modulesSpec</span><span class="p">:</span> <span class="nb">str</span>                       <span class="o">=</span> <span class="s1">''</span>
        
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SFH</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSP</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nebular</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">attenuation</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">agn</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">restframe</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshifting</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modulesStr</span>                        <span class="o">+=</span> <span class="sa">f</span><span class="s1">'</span><span class="se">\n\n</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">'</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">'</span><span class="se">\n</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">'</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modulesSpec</span>                       <span class="o">+=</span> <span class="n">indent</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="se">\n</span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s1">'</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s1">'</span><span class="p">),</span> <span class="s1">'   '</span><span class="p">)</span>

<div class="viewcode-block" id="CigaleSED._checkModule"><a class="viewcode-back" href="../../API/sed.html#SED.sed.CigaleSED._checkModule">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_checkModule</span><span class="p">(</span><span class="n">modules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">inheritedClass</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Check that the given list of Cigale modules belong to the correct class they should inherit from.</span>
<span class="sd">        </span>
<span class="sd">        :param modules: modules to check the inheritance</span>
<span class="sd">        :type modules: :python:`list`</span>
<span class="sd">        :param inheritedClass: class to check against for inheritance</span>
<span class="sd">        </span>
<span class="sd">        :returns: the list of modules if all the modules inherit from the given class</span>
<span class="sd">        :rtype: :python:`list`</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if one of the modules in **modules** does not inherit from **inheritedClass**</span>
<span class="sd">        '''</span>
        
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">inheritedClass</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'module </span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> is not an instance of a subclass of </span><span class="si">{</span><span class="n">inheritedClass</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">.'</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">modules</span></div>
    
    <span class="c1">###############################</span>
    <span class="c1">#       Text formatting       #</span>
    <span class="c1">###############################</span>
    
<div class="viewcode-block" id="CigaleSED.analysisParamsModule"><a class="viewcode-back" href="../../API/sed.html#SED.sed.CigaleSED.analysisParamsModule">[docs]</a>    <span class="k">def</span> <span class="nf">analysisParamsModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">physical_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">save_best_sed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                             <span class="n">save_chi2</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">lim_flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">mock_flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">redshift_decimals</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate the analysis_params module text for Cigale.</span>
<span class="sd">        </span>
<span class="sd">        :param physical_properties: physical properties to estimate at the end of the SED fitting. If :python:`None`, all properties are computed.</span>
<span class="sd">        :type physical_properties: :python:`list[str]`</span>
<span class="sd">        :param bands: list of bands for which to estimate the fluxes. Note that this is independent from the fluxes actually fitted to estimate the physical properties. If :python:`None`, the same bands as the ones provided in **filters** will be used.</span>
<span class="sd">        :type bands: :python:`list[str]`</span>
<span class="sd">        :param save_best_sed: whether to save the best SED for each observation into a file or not</span>
<span class="sd">        :type save_best_sed: :python:`bool`</span>
<span class="sd">        :param save_chi2: whether to save the raw chi2 or not. It occupies ~15 MB/million models/variable.</span>
<span class="sd">        :type save_chi2: :python:`bool`</span>
<span class="sd">        :param lim_flag: if :python:`True`, for each object check whether upper limits are present and analyse them</span>
<span class="sd">        :type lim_flag: :python:`bool`</span>
<span class="sd">        :param mock_flag: if :python:`True`, for each object we create a mock object and analyse them</span>
<span class="sd">        :type bool_mock: :python:`bool`</span>
<span class="sd">        :param redshift_decimals: when redshifts are not given explicitly in the redshifting module, number of decimals to round the observed redshifts to compute the grid of models. To disable rounding give :python:`-1`. Do not round if you use narrow-band filters.</span>
<span class="sd">        :type redshift_decimals: :python:`int`</span>
<span class="sd">        :param int blocks: number of blocks to compute the models and analyse the observations. If there is enough memory, we strongly recommend this to be set to :python:`1`.</span>
<span class="sd">        :type blocks: :python:`int`</span>
<span class="sd">        </span>
<span class="sd">        :returns: module text for the analysis parameters</span>
<span class="sd">        :rtype: :python:`str`</span>
<span class="sd">        '''</span>
        
        <span class="n">text</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s1">'''</span>
<span class="s1">        # Configuration of the statistical analysis method.</span>
<span class="s1">        [analysis_params]</span>
<span class="s1">          # List of the physical properties to estimate. Leave empty to analyse</span>
<span class="s1">          # all the physical properties (not recommended when there are many</span>
<span class="s1">          # models).</span>
<span class="s1">          variables = </span><span class="si">{</span><span class="n">physical_properties</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          # List of bands for which to estimate the fluxes. Note that this is</span>
<span class="s1">          # independent from the fluxes actually fitted to estimate the physical</span>
<span class="s1">          # properties.</span>
<span class="s1">          bands = </span><span class="si">{</span><span class="n">bands</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          # If true, save the best SED for each observation to a file.</span>
<span class="s1">          save_best_sed = </span><span class="si">{</span><span class="n">save_best_sed</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          # If true, for each observation and each analysed property, save the raw</span>
<span class="s1">          # chi2. It occupies ~15 MB/million models/variable.</span>
<span class="s1">          save_chi2 = </span><span class="si">{</span><span class="n">save_chi2</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          # If true, for each object check whether upper limits are present and</span>
<span class="s1">          # analyse them.</span>
<span class="s1">          lim_flag = </span><span class="si">{</span><span class="n">lim_flag</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          # If true, for each object we create a mock object and analyse them.</span>
<span class="s1">          mock_flag = </span><span class="si">{</span><span class="n">mock_flag</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          # When redshifts are not given explicitly in the redshifting module,</span>
<span class="s1">          # number of decimals to round the observed redshifts to compute the grid</span>
<span class="s1">          # of models. To disable rounding give a negative value. Do not round if</span>
<span class="s1">          # you use narrow-band filters.</span>
<span class="s1">          redshift_decimals = </span><span class="si">{</span><span class="n">redshift_decimals</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          # Number of blocks to compute the models and analyse the observations.</span>
<span class="s1">          # If there is enough memory, we strongly recommend this to be set to 1.</span>
<span class="s1">          blocks = </span><span class="si">{</span><span class="n">blocks</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        '''</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">text</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate a parameter file text used by the SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        :returns: the text</span>
<span class="sd">        :rtype: :python:`str`</span>
<span class="sd">        '''</span>
        
        <span class="c1"># %INPUTCATALOGUEINFORMATION% and %NCORES% are replaced when the run method is launched</span>
        
        <span class="n">text1</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s1">'''</span><span class="se">\</span>
<span class="s1">        # File containing the input data. The columns are 'id' (name of the</span>
<span class="s1">        # object), 'redshift' (if 0 the distance is assumed to be 10 pc),</span>
<span class="s1">        # 'distance' (Mpc, optional, if present it will be used in lieu of the</span>
<span class="s1">        # distance computed from the redshift), the filter names for the fluxes,</span>
<span class="s1">        # and the filter names with the '_err' suffix for the uncertainties. The</span>
<span class="s1">        # fluxes and the uncertainties must be in mJy for broadband data and in</span>
<span class="s1">        # W/m² for emission lines. This file is optional to generate the</span>
<span class="s1">        # configuration file, in particular for the savefluxes module.</span>
<span class="s1">        data_file = %INPUTCATALOGUEINFORMATION%</span>
<span class="s1">        </span>
<span class="s1">        # Optional file containing the list of physical parameters. Each column</span>
<span class="s1">        # must be in the form module_name.parameter_name, with each line being a</span>
<span class="s1">        # different model. The columns must be in the order the modules will be</span>
<span class="s1">        # called. The redshift column must be the last one. Finally, if this</span>
<span class="s1">        # parameter is not empty, cigale will not interpret the configuration</span>
<span class="s1">        # parameters given in pcigale.ini. They will be given only for</span>
<span class="s1">        # information. Note that this module should only be used in conjonction</span>
<span class="s1">        # with the savefluxes module. Using it with the pdf_analysis module will</span>
<span class="s1">        # yield incorrect results.</span>
<span class="s1">        parameters_file = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_file</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        </span>
<span class="s1">        # Avaiable modules to compute the models. The order must be kept.</span>
<span class="s1">        # SFH:</span>
<span class="s1">        # * sfh2exp (double exponential)</span>
<span class="s1">        # * sfhdelayed (delayed SFH with optional exponential burst)</span>
<span class="s1">        # * sfhdelayedbq (delayed SFH with optional constant burst/quench)</span>
<span class="s1">        # * sfhfromfile (arbitrary SFH read from an input file)</span>
<span class="s1">        # * sfhperiodic (periodic SFH, exponential, rectangle or delayed)</span>
<span class="s1">        # SSP:</span>
<span class="s1">        # * bc03 (Bruzual and Charlot 2003)</span>
<span class="s1">        # * m2005 (Maraston 2005; note that it cannot be combined with the nebular module)</span>
<span class="s1">        # Nebular emission:</span>
<span class="s1">        # * nebular (continuum and line nebular emission)</span>
<span class="s1">        # Dust attenuation:</span>
<span class="s1">        # * dustatt_modified_CF00 (modified Charlot &amp; Fall 2000 attenuation law)</span>
<span class="s1">        # * dustatt_modified_starburst (modified Calzetti 2000 attenuaton law)</span>
<span class="s1">        # Dust emission:</span>
<span class="s1">        # * casey2012 (Casey 2012 dust emission models)</span>
<span class="s1">        # * dale2014 (Dale et al. 2014 dust emission templates)</span>
<span class="s1">        # * dl2007 (Draine &amp; Li 2007 dust emission models)</span>
<span class="s1">        # * dl2014 (Draine et al. 2014 update of the previous models)</span>
<span class="s1">        # * themis (Themis dust emission models from Jones et al. 2017)</span>
<span class="s1">        # AGN:</span>
<span class="s1">        # * fritz2006 (AGN models from Fritz et al. 2006)</span>
<span class="s1">        # Radio:</span>
<span class="s1">        # * radio (synchrotron emission)</span>
<span class="s1">        # Restframe parameters:</span>
<span class="s1">        # * restframe_parameters (UV slope (β), IRX, D4000, EW, etc.)</span>
<span class="s1">        # Redshift+IGM:</span>
<span class="s1">        # * redshifting (mandatory, also includes the IGM from Meiksin 2006)</span>
<span class="s1">        sed_modules = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">moduleNames</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        </span>
<span class="s1">        # Method used for statistical analysis. Available methods: pdf_analysis,</span>
<span class="s1">        # savefluxes.</span>
<span class="s1">        analysis_method = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        </span>
<span class="s1">        # Number of CPU cores available. This computer has 8 cores.</span>
<span class="s1">        cores = %NCORES%</span>
<span class="s1">        </span>
<span class="s1">        # Bands to consider. To consider uncertainties too, the name of the band</span>
<span class="s1">        # must be indicated with the _err suffix. For instance: FUV, FUV_err.</span>
<span class="s1">        bands = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        </span>
<span class="s1">        # Properties to be considered. All properties are to be given in the</span>
<span class="s1">        # rest frame rather than the observed frame. This is the case for</span>
<span class="s1">        # instance the equivalent widths and for luminosity densities.</span>
<span class="s1">        properties = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        </span>
<span class="s1">        </span>
<span class="s1">        # Configuration of the SED creation modules.</span>
<span class="s1">        [sed_modules_params]</span>
<span class="s1">        '''</span><span class="p">)</span>
        
        <span class="n">text2</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modulesStr</span><span class="si">}</span><span class="s1">'</span><span class="p">),</span> <span class="s1">'   '</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">text1</span> <span class="o">+</span> <span class="n">text2</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">specParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate the spec parameter file text associated to the given sed modules.</span>
<span class="sd">        </span>
<span class="sd">        :returns: spec parameter file text</span>
<span class="sd">        :rtype: :python:`str`</span>
<span class="sd">        '''</span>
        
        <span class="n">text</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">'''</span><span class="se">\</span>
<span class="s1">        data_file = string()</span>
<span class="s1">        parameters_file = string()</span>
<span class="s1">        sed_modules = cigale_string_list()</span>
<span class="s1">        analysis_method = string()</span>
<span class="s1">        cores = integer(min=1)</span>
<span class="s1">        bands = cigale_string_list()</span>
<span class="s1">        properties = cigale_string_list()</span>
<span class="s1">        [sed_modules_params]</span>
<span class="s1">        %MODULESSPEC%</span>
<span class="s1">        [analysis_params]</span>
<span class="s1">          variables = cigale_string_list()</span>
<span class="s1">          save_best_sed = boolean()</span>
<span class="s1">          save_chi2 = boolean()</span>
<span class="s1">          lim_flag = boolean()</span>
<span class="s1">          mock_flag = boolean()</span>
<span class="s1">          redshift_decimals = integer()</span>
<span class="s1">          blocks = integer(min=1)</span>
<span class="s1">        '''</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'%MODULESSPEC%'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modulesSpec</span><span class="p">)</span>
    
    <span class="c1">#############################</span>
    <span class="c1">#        Run methods        #</span>
    <span class="c1">#############################</span>
    
<div class="viewcode-block" id="CigaleSED.startCigale"><a class="viewcode-back" href="../../API/sed.html#SED.sed.CigaleSED.startCigale">[docs]</a>    <span class="k">def</span> <span class="nf">startCigale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span> <span class="n">TextIOBase</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Wrapper around default :py:meth:`SED.startProcess` which allows to run Cigale.</span>
<span class="sd">        </span>
<span class="sd">        :param log: (**Optional**) oppened log file</span>
<span class="sd">        :type log: `TextIOBase`_</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">startProcess</span><span class="p">([</span><span class="s1">'pcigale'</span><span class="p">,</span> <span class="s1">'run'</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">errMsg</span><span class="o">=</span><span class="s1">'SED fitting failed.'</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catalogue</span><span class="p">:</span> <span class="n">CigaleCat</span><span class="p">,</span> 
                 <span class="n">ncores</span><span class="p">:</span> <span class="nb">int</span>                              <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">physical_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>               <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">save_best_sed</span><span class="p">:</span> <span class="nb">bool</span>                      <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">save_chi2</span><span class="p">:</span> <span class="nb">bool</span>                          <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">lim_flag</span><span class="p">:</span> <span class="nb">bool</span>                           <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">mock_flag</span><span class="p">:</span> <span class="nb">bool</span>                          <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">redshift_decimals</span><span class="p">:</span> <span class="nb">int</span>                   <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span>                              <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CigaleOutput</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Start the SED fitting on the given data using the built-in SED fitting parameters.</span>
<span class="sd">        </span>
<span class="sd">        :param CigaleCat catalogue: catalogue to use for the SED-fitting</span>
<span class="sd">        </span>
<span class="sd">        :param ncores: (**Optional**) number of cores (technically threads) to use to generate the grid of parameters</span>
<span class="sd">        :type ncores: :python:`int`</span>
<span class="sd">        :param physical_properties: (**Optional**) physical properties to estimate at the end of the SED fitting. If :python:`None`, all properties are computed.</span>
<span class="sd">        :type physical_properties: :python:`list[str]`</span>
<span class="sd">        :param bands: (**Optional**) list of bands for which to estimate the fluxes. Note that this is independent from the fluxes actually fitted to estimate the physical properties. If :python:`None`, the same bands as the ones provided in **filters** will be used.</span>
<span class="sd">        :type bands: :python:`list[str]`</span>
<span class="sd">        :param save_best_sed: (**Optional**) whether to save the best SED for each observation into a file or not</span>
<span class="sd">        :type save_best_sed: :python:`bool`</span>
<span class="sd">        :param save_chi2: (**Optional**) whether to save the raw chi2 or not. It occupies ~15 MB/million models/variable.</span>
<span class="sd">        :type save_chi2: :python:`bool`</span>
<span class="sd">        :param lim_flag: (**Optional**) if :python:`True`, for each object check whether upper limits are present and analyse them</span>
<span class="sd">        :type lim_flag: :python:`bool`</span>
<span class="sd">        :param mock_flag: (**Optional**) if :python:`True`, for each object we create a mock object and analyse them</span>
<span class="sd">        :type mock_flag: :python:`bool`</span>
<span class="sd">        :param redshift_decimals: (**Optional**) when redshifts are not given explicitly in the redshifting module, number of decimals to round the observed redshifts to compute the grid of models. To disable rounding give :python:`-1`. Do not round if you use narrow-band filters.</span>
<span class="sd">        :type redshift_decimals: :python:`int`</span>
<span class="sd">        :param blocks: (**Optional**) number of blocks to compute the models and analyse the observations. If there is enough memory, we strongly recommend this to be set to :python:`1`.</span>
<span class="sd">        :type blocks: :python:`int`</span>
<span class="sd">        </span>
<span class="sd">        :returns: Cigale output file object with data from the loaded file</span>
<span class="sd">        :rtype: CigaleOutput</span>
<span class="sd">    </span>
<span class="sd">        :raises TypeError: if **catalogue** is not of type :py:class:`~.LePhareCat`</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">catalogue</span><span class="p">,</span> <span class="n">CigaleCat</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'catalogue has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">catalogue</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a CigaleCat instance.'</span><span class="p">)</span>
            
        <span class="c1"># Check parameters</span>
        <span class="n">ncores</span>            <span class="o">=</span> <span class="n">IntProperty</span><span class="p">(</span><span class="n">ncores</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">phys_prop</span>         <span class="o">=</span> <span class="n">ListStrProperty</span><span class="p">(</span><span class="n">physical_properties</span> <span class="k">if</span> <span class="n">physical_properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="s1">''</span><span class="p">])</span>
        <span class="n">bands</span>             <span class="o">=</span> <span class="n">ListStrProperty</span><span class="p">(</span><span class="n">bands</span> <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">save_best_sed</span>     <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">save_best_sed</span><span class="p">)</span>
        <span class="n">save_chi2</span>         <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">save_chi2</span><span class="p">)</span>
        <span class="n">lim_flag</span>          <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">lim_flag</span><span class="p">)</span>
        <span class="n">mock_flag</span>         <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">mock_flag</span><span class="p">)</span>
        <span class="n">redshift_decimals</span> <span class="o">=</span> <span class="n">IntProperty</span><span class="p">(</span><span class="n">redshift_decimals</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">blocks</span>            <span class="o">=</span> <span class="n">IntProperty</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Make output directory</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">'</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            
        <span class="c1"># Delete output directory in the galaxy directory if already present (otherwise Cigale will make a new one with a different name)</span>
        <span class="n">outDir</span>    <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">'out'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outDir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">outDir</span><span class="p">)</span>
        
        <span class="c1"># Param file in cigale works in a weird way, better to always use the default name (pcigale.ini and pcigale.ini.spec)</span>
        <span class="n">paramFile</span> <span class="o">=</span> <span class="s1">'pcigale.ini'</span>
        <span class="n">pfile</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">paramFile</span><span class="p">)</span>
        <span class="n">sfile</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">'pcigale.ini.spec'</span><span class="p">)</span>
        <span class="n">logFile</span>   <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.mag'</span><span class="p">,</span> <span class="s1">'_cig.log'</span><span class="p">))</span>
        <span class="n">oCatFile</span>  <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span>    <span class="s1">'results.fits'</span><span class="p">)</span>
        
        <span class="c1"># Generate and write parameters file</span>
        <span class="n">beg_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'%INPUTCATALOGUEINFORMATION%'</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'%NCORES%'</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">ncores</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">end_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisParamsModule</span><span class="p">(</span><span class="n">phys_prop</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">save_best_sed</span><span class="p">,</span> <span class="n">save_chi2</span><span class="p">,</span> <span class="n">lim_flag</span><span class="p">,</span> <span class="n">mock_flag</span><span class="p">,</span> <span class="n">redshift_decimals</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">beg_param</span> <span class="o">+</span> <span class="n">end_param</span><span class="p">)</span> 
            
        <span class="c1"># Generate and write spec file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specParameters</span><span class="p">)</span>
        
        <span class="c1"># Write catalogue</span>
        <span class="n">catalogue</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logFile</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>
            
            <span class="c1">###################################</span>
            <span class="c1">#         Run SED fitting         #</span>
            <span class="c1">###################################</span>
            
            <span class="c1"># Move to directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">startCigale</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            
            <span class="c1"># Move back to parent directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'..'</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">CigaleOutput</span><span class="p">(</span><span class="n">oCatFile</span><span class="p">)</span> </div>
                

<div class="viewcode-block" id="LePhareSED"><a class="viewcode-back" href="../../API/sed.html#SED.sed.LePhareSED">[docs]</a><span class="k">class</span> <span class="nc">LePhareSED</span><span class="p">(</span><span class="n">SED</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Implements LePhare SED object.</span>
<span class="sd">    </span>
<span class="sd">    :param ID: an identifier used to name the output files created during the SED fitting process</span>
<span class="sd">    </span>
<span class="sd">    :param properties: (**Optional**) properties to be passed to LePhare to compute the models grid and perform the SED fitting</span>
<span class="sd">    :type properties: :python:`dict[str, str]`</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError: if one of the properties keys is not of type :python:`str`</span>
<span class="sd">    :raises ValueError: if one of the properties does not have a valid name (see list below)</span>
<span class="sd">    </span>
<span class="sd">    **Accepted properties are:**</span>
<span class="sd">    </span>
<span class="sd">        * **STAR_SED** [:python:`str`]: stellar library list file (full path)</span>
<span class="sd">        * **STAR_FSCALE** [:python:`float`]: stellar flux scale</span>
<span class="sd">        * **STAR_LIB** [:python:`str`]: stellar library to use (default libraries found at :file:`$LEPHAREWORK/lib_bin`). To not use a stellar library, provide :python:`'NONE'`.</span>
<span class="sd">        * **QSO_SED** [:python:`str`]: QSO list file (full path)</span>
<span class="sd">        * **QSO_FSCALE** [:python:`float`]: QSO flux scale</span>
<span class="sd">        * **QSO_LIB** [:python:`str`]: QSO library to use (default libraries found at :file:`LEPHAREWORK/lib_bin`). To not use a QSO library, provide :python:`'NONE'`.</span>
<span class="sd">        * **GAL_SED** [:python:`str`]: galaxy library list file (full path)</span>
<span class="sd">        * **GAL_FSCALE** [:python:`float`]: galaxy flux scale</span>
<span class="sd">        * **GAL_LIB** [:python:`str`]: galaxy library to use (default libraries found at :file:`$LEPHAREWORK/lib_bin`). To not use a galaxy library, provide :python:`'NONE'`.</span>
<span class="sd">        * **SEL_AGE** [:python:`str`]: stellar ages list (full path)</span>
<span class="sd">        * **AGE_RANGE** [:python:`list[float]`]: minimum and maximum ages in years</span>
<span class="sd">        * **FILTER_LIST** [:python:`list[str]`]: list of filter names used for the fit (must all be located in :file:`$LEPHAREDIR/filt directory`)</span>
<span class="sd">        * **TRANS_TYPE** [:python:`int`]: transmission type (:python:`0` for Energy, :python:`1` for photons)</span>
<span class="sd">        * **FILTER_CALIB** [:python:`int`]: filter calibration (:python:`0` for fnu=ctt, :python:`1` for nu.fnu=ctt, :python:`2` for fnu=nu, :python:`3` for fnu=Black Body @ T=10000K, :python:`4` for MIPS (leff with nu fnu=ctt and flux with BB @ 10000K) </span>
<span class="sd">        * **FILTER_FILE** [:python:`str`]: filter file (must be located in :file:`$LEPHAREWORK/filt` directory)</span>
<span class="sd">        * **STAR_LIB_IN** [:python:`str`]: input stellar library (dupplicate with **STAR_LIB** ?)</span>
<span class="sd">        * **STAR_LIB_OUT** [:python:`str`]: output stellar magnitudes</span>
<span class="sd">        * **QSO_LIB_IN** [:python:`str`]: input QSO library (dupplicate with **QSO_LIB** ?)</span>
<span class="sd">        * **QSO_LIB_OUT** [:python:`str`]: output QSO magnitudes</span>
<span class="sd">        * **GAL_LIB_IN** [:python:`str`]: input galaxy library (dupplicate with **GAL_LIB** ?)</span>
<span class="sd">        * **GAL_LIB_OUT** [:python:`str`]: output galaxy magnitudes</span>
<span class="sd">        * **MAGTYPE** [:py:class:`~.MagType`]: magnitude system used (:py:attr:`~.MagType.AB` or :py:attr:`~.MagType.VEGA`)</span>
<span class="sd">        * **Z_STEP** [:python:`list[int/float]`]: redshift step properties. Values are in this order: redshift step, max redshift, redshift step for redshifts above 6 (coarser sampling).</span>
<span class="sd">        * **COSMOLOGY** [:python:`list[int/float]`]: cosmology parameters. Values are in this order: Hubble constant :math:`H_0`, baryon fraction :math:`\Omega_{m, 0}`, cosmological constant fraction :math:`\Omega_{\lambda, 0}`.</span>
<span class="sd">        * **MOD_EXTINC** [:python:`list[int/float]`]: minimum and maximum model extinctions</span>
<span class="sd">        * **EXTINC_LAW** [:python:`str`]: extinction law file (in :file:`$LEPHAREDIR/ext`)</span>
<span class="sd">        * **EB_V** [:python:`list[int/float]`]: color excess :math:`E(B-V)`. It must contain less than 50 values.</span>
<span class="sd">        * **EM_LINES** [:py:class:`~.YESNO`]: whether to consider emission lines or not. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">        * **BD_SCALE** [:python:`int`]: number of bands used for scaling (:python:`0` means all bands). See LePhare documentation for more details.</span>
<span class="sd">        * **GLB_CONTEXT** [:python:`int`]: context number (:python:`0` means all bands). See LePhare documentation for more details.</span>
<span class="sd">        * **ERR_SCALE** [:python:`list[int/float]`]: magnitude errors per band to add in quadrature</span>
<span class="sd">        * **ERR_FACTOR** [:python:`int/float`]: scaling factor to apply to the errors</span>
<span class="sd">        * **ZPHOTLIB** [:python:`list[str]`]: librairies used to compute the :math:`\chi^2`. Maximum number is :python:`3`.</span>
<span class="sd">        * **ADD_EMLINES** [:py:class:`~.YESNO`]: whether to add emission lines or not (dupplicate with **EM_LINES** ?). Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">        * **FIR_LIB** [:python:`str`]: far IR library</span>
<span class="sd">        * **FIR_LMIN** [:python:`int/float`]: minimum wavelength (in microns) for the far IR analysis</span>
<span class="sd">        * **FIR_CONT** [:python:`int/float`]: far IR continuum. Use :python:`-1` for no continuum.</span>
<span class="sd">        * **FIR_SCALE** [:python:`int/float`]: far IR flux scale. Use :python:`-1` to skip flux scale.</span>
<span class="sd">        * **FIR_FREESCALE** [:python:`str`]: whether to let the far IR spectrum freely scale</span>
<span class="sd">        * **FIR_SUBSTELLAR** [:python:`str`]: ???</span>
<span class="sd">        * **PHYS_LIB** [:python:`str`]: physical stochastic library</span>
<span class="sd">        * **PHYS_CONT** [:python:`int/float`]: physical continuum. Use :python:`-1` for no continuum.</span>
<span class="sd">        * **PHYS_SCALE** [:python:`int/float`]: physical flux scale. Use :python:`-1` to skip flux scale.</span>
<span class="sd">        * **PHYS_NMAX** [:python:`int`]: ???</span>
<span class="sd">        * **MAG_ABS** [:python:`list[int/float]`]: minimum and maximum values for the magnitudes.</span>
<span class="sd">        * **MAG_REF** [:python:`int`]: reference band used by **MAG_ABS**</span>
<span class="sd">        * **Z_RANGE** [:python:`list[int/float]`]: minimum and maximum redshifts used by the galaxy library</span>
<span class="sd">        * **EBV_RANGE** [:python:`list[int/float]`]: minimum and maximum colour excess :math:`E(B-V)`</span>
<span class="sd">        * **ZFIX** [:py:class:`~.YESNO`]: whether to fix the redshift or let it free. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">        * **Z_INTERP** [:py:class:`~.YESNO`]: whether to perform an interpolation to find the redshift. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">        * **DZ_WIN** [:python:`int/float`]: window search for second peak. Must be between :python:`0` and :python:`5`.</span>
<span class="sd">        * **MIN_THRES** [:python:`int/float`]: minimum threshold for second peak. Must be between :python:`0` and :python:`1`.</span>
<span class="sd">        * **MABS_METHOD** [:python:`int`]: method used to compute magnitudes (:python:`0` : obs-&gt;Ref, :python:`1` : best obs-&gt;Ref, :python:`2` : fixed obs-&gt;Ref, :python:`3` : mag from best SED, :python:`4` : Zbin). See LePhare documentation for more details.</span>
<span class="sd">        * **MABS_CONTEXT** [:python:`int`]: context for absolute magnitudes. See LePhare documentation for more details.</span>
<span class="sd">        * **MABS_REF** [:python:`int`]: reference band used to compute the absolute magnitudes. This is only used if :python:`MABS_METHOD = 2`.</span>
<span class="sd">        * **MABS_FILT** [:python:`list[int]`]: filters used in each redshift bin (see **MABS_ZBIN**). This is only used if :python:`MABS_METHOD = 4`.</span>
<span class="sd">        * **MABS_ZBIN** [:python:`list[int/float]`]: redshift bins (must be an even number). This is only used if :python:`MABS_METHOD = 4`.</span>
<span class="sd">        * **SPEC_OUT** [:py:class:`~.YESNO`]: whether to output the spectrum of each object or not. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">        * **CHI2_OUT** [:py:class:`~.YESNO`]: whether to generate an output file with all the values or not. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~YESNO.NO`.</span>
<span class="sd">        * **PDZ_OUT** [:python:`str`]: output file name for the PDZ analysis. To not do the pdz analysis, provide :python:`'NONE'`.</span>
<span class="sd">        * **PDZ_MABS_FILT** [:python:`list[int]`]: absolute magnitude for reference filters to be extracted. See LePhare documentation for more details.</span>
<span class="sd">        * **FAST_MODE** [:py:class:`~.YESNO`]: whether to perform a fast computation or not. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">        * **COL_NUM** [:python:`int`]: number of colors used</span>
<span class="sd">        * **COL_SIGMA** [:python:`int/float`]: quantity by which to enlarge the errors on the colors</span>
<span class="sd">        * **COL_SEL** [:py:class:`~.ANDOR`]: operation used to combine colors. Accepted values are :py:attr:`~.ANDOR.AND` or :py:attr:`~.ANDOR.OR`.</span>
<span class="sd">        * **AUTO_ADAPT** [:py:class:`~.YESNO`]: whether to use an adaptive method with a z-spec sample. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">        * **ADAPT_BAND** [:python:`list[int]`]: reference band, band1 and band2 for colors</span>
<span class="sd">        * **ADAPT_LIM** [:python:`list[int/float]`]: magnitude limit for spectro in reference band</span>
<span class="sd">        * **ADAPT_POLY** [:python:`int`]: number of coefficients in polynomial. Maximum is :python:`4`.</span>
<span class="sd">        * **ADAPT_METH** [:python:`int`]: fit method, :python:`1` for color model, :python:`2` for redshift, :python:`3` for models. See LePhare documentation for more details.</span>
<span class="sd">        * **ADAPT_CONTEXT** [:python:`int`]: context for the bands used for training. See LePhare documentation for more details.</span>
<span class="sd">        * **ADAPT_ZBIN** [:python:`list[int/float]`]: minimum and maximum redshift interval used for training.</span>
<span class="sd">        </span>
<span class="sd">    .. warning::</span>
<span class="sd">        </span>
<span class="sd">        It is mandatory to define on your OS two environment variables:</span>
<span class="sd">            </span>
<span class="sd">            * :file:`$LEPHAREWORK` which points to LePhare working directory</span>
<span class="sd">            * :file:`$LEPHAREDIR` which points to LePhare main directory</span>
<span class="sd">            </span>
<span class="sd">        These paths may be expanded to check whether the given files exist and can be used by the user to shorten some path names when providing the SED properties.</span>
<span class="sd">    '''</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'properties parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a dict.'</span><span class="p">)</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#: Will be used to generate a custom directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">Any</span>         <span class="o">=</span> <span class="n">ID</span>
        
        <span class="c1"># Output parameter file is defined through the ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputParamFile</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">_output.para'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outParam</span>        <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">'</span> <span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">LePhareOutputParam</span><span class="p">}</span>
        
        <span class="c1">#: Allowed keys and corresponding allowed types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'STAR_SED'</span>       <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREDIR'</span><span class="p">,</span> <span class="s1">'sed'</span><span class="p">,</span> <span class="s1">'STAR'</span><span class="p">,</span> <span class="s1">'STAR_MOD.list'</span><span class="p">)),</span>
                     
                     <span class="s1">'STAR_FSCALE'</span>    <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">3.432e-09</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'STAR_LIB'</span>       <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'LIB_STAR_bc03'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREWORK'</span><span class="p">,</span> <span class="s1">'lib_bin'</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">'.bin'</span><span class="p">),</span>
                     
                     <span class="s1">'QSO_SED'</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREDIR'</span><span class="p">,</span> <span class="s1">'sed'</span><span class="p">,</span> <span class="s1">'QSO'</span><span class="p">,</span> <span class="s1">'QSO_MOD.list'</span><span class="p">)),</span>
                     
                     <span class="s1">'QSO_FSCALE'</span>     <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'QSO_LIB'</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'LIB_QSO_bc03'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREWORK'</span><span class="p">,</span> <span class="s1">'lib_bin'</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">'.bin'</span><span class="p">),</span>
                     
                     <span class="s1">'GAL_SED'</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREDIR'</span><span class="p">,</span> <span class="s1">'sed'</span><span class="p">,</span> <span class="s1">'GAL'</span><span class="p">,</span> <span class="s1">'BC03_CHAB'</span><span class="p">,</span> <span class="s1">'BC03_MOD.list'</span><span class="p">)),</span>
                     
                     <span class="s1">'GAL_FSCALE'</span>     <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'GAL_LIB'</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'LIB_bc03'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREWORK'</span><span class="p">,</span> <span class="s1">'lib_bin'</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">'.bin'</span><span class="p">),</span>
                     
                     <span class="s1">'SEL_AGE'</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREDIR'</span><span class="p">,</span> <span class="s1">'sed'</span><span class="p">,</span> <span class="s1">'GAL'</span><span class="p">,</span> <span class="s1">'BC03_CHAB'</span><span class="p">,</span> <span class="s1">'BC03_AGE.list'</span><span class="p">)),</span>
                     
                     <span class="s1">'AGE_RANGE'</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">3e9</span><span class="p">,</span> <span class="mf">11e9</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                                 <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                 <span class="n">testMsg</span><span class="o">=</span><span class="s1">'AGE_RANGE property must be a length 2 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'FILTER_LIST'</span>    <span class="p">:</span> <span class="n">ListPathProperty</span><span class="p">([</span><span class="s1">'hst/acs_f435w.pb'</span><span class="p">,</span> <span class="s1">'hst/acs_f606w.pb'</span><span class="p">,</span> <span class="s1">'hst/acs_f775w.pb'</span><span class="p">,</span> <span class="s1">'hst/acs_f850lp.pb'</span><span class="p">],</span> 
                                                         <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREDIR'</span><span class="p">,</span> <span class="s1">'filt'</span><span class="p">)),</span>
                     
                     <span class="s1">'TRANS_TYPE'</span>     <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                     
                     <span class="s1">'FILTER_CALIB'</span>   <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                     
                     <span class="s1">'FILTER_FILE'</span>    <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'HDF_bc03.filt'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREWORK'</span><span class="p">,</span> <span class="s1">'filt'</span><span class="p">)),</span>
                     
                     <span class="s1">'STAR_LIB_IN'</span>    <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'LIB_STAR_bc03'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREWORK'</span><span class="p">,</span> <span class="s1">'lib_bin'</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">'.bin'</span><span class="p">),</span>
                     
                     <span class="s1">'STAR_LIB_OUT'</span>   <span class="p">:</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">'STAR_HDF_bc03'</span><span class="p">),</span>
                     
                     <span class="s1">'QSO_LIB_IN'</span>     <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'LIB_QSO_bc03'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREWORK'</span><span class="p">,</span> <span class="s1">'lib_bin'</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">'.bin'</span><span class="p">),</span>
                     
                     <span class="s1">'QSO_LIB_OUT'</span>    <span class="p">:</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">'QSO_HDF_bc03'</span><span class="p">),</span>
                     
                     <span class="s1">'GAL_LIB_IN'</span>     <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'LIB_bc03'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREWORK'</span><span class="p">,</span> <span class="s1">'lib_bin'</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">'.bin'</span><span class="p">),</span>
                     
                     <span class="s1">'GAL_LIB_OUT'</span>    <span class="p">:</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">'HDF_bc03'</span><span class="p">),</span>
                     
                     <span class="s1">'MAGTYPE'</span>        <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">MagType</span><span class="o">.</span><span class="n">AB</span><span class="p">),</span>
                     
                     <span class="s1">'Z_STEP'</span>         <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'Z_STEP property must be a length 3 list where the last step must be larger than the first one.'</span><span class="p">),</span>
                     
                     <span class="s1">'COSMOLOGY'</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">70.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">,</span> 
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'Z_STEP property must be a length 3 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'MOD_EXTINC'</span>     <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span>
                                                 <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                 <span class="n">testMsg</span><span class="o">=</span><span class="s1">'MOD_EXTINC property must be an increasing length 2 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'EXTINC_LAW'</span>     <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'calzetti.dat'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'$LEPHAREDIR'</span><span class="p">,</span> <span class="s1">'ext'</span><span class="p">)),</span>
                     
                     <span class="s1">'EB_V'</span>           <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">49</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">((</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))),</span> 
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'EB_V property must be an increasing list with a maximum length of 49.'</span><span class="p">),</span>
                     
                     <span class="s1">'EM_LINES'</span>       <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'LIB_ASCII'</span>      <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'BD_SCALE'</span>       <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'GLB_CONTEXT'</span>    <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'ERR_SCALE'</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'ERR_FACTOR'</span>     <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'ZPHOTLIB'</span>       <span class="p">:</span> <span class="n">ListStrProperty</span><span class="p">([</span><span class="s1">'HDF_bc03'</span><span class="p">,</span> <span class="s1">'STAR_HDF_bc03'</span><span class="p">,</span> <span class="s1">'QSO_HDF_bc03'</span><span class="p">]),</span>
                     
                     <span class="s1">'ADD_EMLINES'</span>    <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'FIR_LIB'</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'NONE'</span><span class="p">),</span>
                     
                     <span class="s1">'FIR_LMIN'</span>       <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'FIR_CONT'</span>       <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="s1">'-1'</span><span class="p">),</span>
                     
                     <span class="s1">'FIR_SCALE'</span>      <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="s1">'-1'</span><span class="p">),</span>
                     
                     <span class="s1">'FIR_FREESCALE'</span>  <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'FIR_SUBSTELLAR'</span> <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'PHYS_LIB'</span>       <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'NONE'</span><span class="p">),</span>
                     
                     <span class="s1">'PHYS_CONT'</span>      <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="s1">'-1'</span><span class="p">),</span>
                     
                     <span class="s1">'PHYS_SCALE'</span>     <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="s1">'-1'</span><span class="p">),</span>
                     
                     <span class="s1">'PHYS_NMAX'</span>      <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">100000</span><span class="p">),</span>
                     
                     <span class="s1">'MAG_ABS'</span>        <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.0</span><span class="p">],</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">,</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'MAG_ABS property must be a length 2 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'MAG_REF'</span>        <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'Z_RANGE'</span>        <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'Z_RANGE property must be an increasing length 2 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'EBV_RANGE'</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">],</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'EBV_RANGE_RANGE property must be an increasing length 2 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'ZFIX'</span>           <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">YES</span><span class="p">),</span>
                     
                     <span class="s1">'Z_INTERP'</span>       <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'DZ_WIN'</span>         <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                     
                     <span class="s1">'MIN_THRES'</span>      <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                     
                     <span class="s1">'MABS_METHOD'</span>    <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                     
                     <span class="s1">'MABS_CONTEXT'</span>   <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                     
                     <span class="s1">'MABS_REF'</span>       <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span> <span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'MABS_FILT'</span>      <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'MABS_ZBIN'</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">((</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))),</span> 
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'MABS_ZBIN property must be an increasing list with an even length.'</span><span class="p">),</span>
                     
                     <span class="s1">'SPEC_OUT'</span>       <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'CHI2_OUT'</span>       <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'PDZ_OUT'</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">'NONE'</span><span class="p">),</span>
                     
                     <span class="s1">'PDZ_MABS_FILT'</span>  <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'FAST_MODE'</span>      <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'COL_NUM'</span>        <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'COL_SIGMA'</span>      <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'COL_SEL'</span>        <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">ANDOR</span><span class="o">.</span><span class="n">AND</span><span class="p">),</span>
                     
                     <span class="s1">'AUTO_ADAPT'</span>     <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">'ADAPT_BAND'</span>     <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">'ADAPT_LIM'</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">],</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'ADAPT_LIM property must be an increasing length 2 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'ADAPT_POLY'</span>     <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                     
                     <span class="s1">'ADAPT_METH'</span>     <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                     
                     <span class="s1">'ADAPT_CONTEXT'</span>  <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                     
                     <span class="s1">'ADAPT_ZBIN'</span>     <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">'ADAPT_ZBIN property must be an increasing length 2 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'ADAPT_MODBIN'</span>   <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                        <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                        <span class="n">testMsg</span><span class="o">=</span><span class="s1">'ADAPT_MODBIN property must be an increasing length 2 list.'</span><span class="p">),</span>
                     
                     <span class="s1">'ERROR_ADAPT'</span>    <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">)</span>
                     <span class="p">}</span>
        
        <span class="c1"># Set properties given by the user</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'item </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1"> in properties has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type str'</span><span class="p">)</span>
            
            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'item </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1"> in properties does not correspond to a valid item name.'</span><span class="p">)</span>
                
            <span class="c1"># Set Property value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        
    <span class="c1">###############################</span>
    <span class="c1">#       Text formatting       #</span>
    <span class="c1">###############################</span>
    
<div class="viewcode-block" id="LePhareSED.output_parameters"><a class="viewcode-back" href="../../API/sed.html#SED.sed.LePhareSED.output_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">output_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate an output parameter file used by the SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        :param params: list of parameters to activate in the ouput parameters file</span>
<span class="sd">        :type params: :python:`list[str]`</span>
<span class="sd">        </span>
<span class="sd">        .. note ::</span>
<span class="sd">            </span>
<span class="sd">            To know which output parameters can be passed print outParam property, i.e.</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; sed = LePhareSED('identifier')</span>
<span class="sd">            &gt;&gt;&gt; print(sed.outParams)</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'params has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type list.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'one of the values in params is not of type str.'</span><span class="p">)</span>
        
        <span class="c1"># Check and then set given parameters to True</span>
        <span class="n">newParams</span>                <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outParam</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newParams</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">WARNING</span><span class="si">}</span><span class="s1"> invalid parameter name </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">.'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newParams</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># Produce the formatted string</span>
        <span class="k">return</span> <span class="s1">'IDENT</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">'</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">'#</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">'</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">newParams</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span></div>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate a parameter file text used by the SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        :returns: the text</span>
<span class="sd">        :rtype: :python:`str`</span>
<span class="sd">        '''</span>
        
        <span class="c1"># %INPUTCATALOGUEINFORMATION% is replaced when the run method is launched</span>
        
        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'''</span><span class="se">\</span>
<span class="s1">        ##############################################################################</span>
<span class="s1">        #                CREATION OF LIBRARIES FROM SEDs List                        #</span>
<span class="s1">        # $LEPHAREDIR/source/sedtolib -t (S/Q/G) -c $LEPHAREDIR/config/zphot.para    #</span>
<span class="s1">        # help : $LEPHAREDIR/source/sedtolib -h (or -help)                           #</span>
<span class="s1">        ##############################################################################</span>
<span class="s1">        #</span>
<span class="s1">        #------      STELLAR LIBRARY (ASCII SEDs)</span>
<span class="s1">        #</span>
<span class="s1">        STAR_SED </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'STAR_SED'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># STAR list (full path)</span>
<span class="s1">        STAR_FSCALE</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'STAR_FSCALE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Arbitrary Flux Scale</span>
<span class="s1">        STAR_LIB </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'STAR_LIB'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Bin. STAR LIBRARY -&gt; $LEPHAREWORK/lib_bin</span>
<span class="s1">        #</span>
<span class="s1">        #------      QSO LIBRARY (ASCII SEDs)</span>
<span class="s1">        #</span>
<span class="s1">        QSO_SED </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'QSO_SED'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># QSO list (full path)</span>
<span class="s1">        QSO_FSCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'QSO_FSCALE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Arbitrary Flux Scale </span>
<span class="s1">        QSO_LIB	</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'QSO_LIB'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Bin. QSO LIBRARY -&gt; $LEPHAREWORK/lib_bin</span>
<span class="s1">        #</span>
<span class="s1">        #------      GALAXY LIBRARY (ASCII or BINARY SEDs)</span>
<span class="s1">        #</span>
<span class="s1">        GAL_SED	</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'GAL_SED'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># GAL list (full path)</span>
<span class="s1">        GAL_FSCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'GAL_FSCALE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Arbitrary Flux Scale</span>
<span class="s1">        GAL_LIB	</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'GAL_LIB'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Bin. GAL LIBRARY -&gt; $LEPHAREWORK/lib_bin</span>
<span class="s1">        SEL_AGE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'SEL_AGE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Age list(full path, def=NONE)	</span>
<span class="s1">        AGE_RANGE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'AGE_RANGE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Age Min-Max in yr</span>
<span class="s1">        #</span>
<span class="s1">        #############################################################################</span>
<span class="s1">        #                           FILTERS                                         #</span>
<span class="s1">        #  $LEPHAREDIR/source/filter  -c $LEPHAREDIR/config/zphot.para              #</span>
<span class="s1">        #  help: $LEPHAREDIR/source/filter  -h (or -help)                           #</span>
<span class="s1">        #############################################################################</span>
<span class="s1">        #</span>
<span class="s1">        FILTER_LIST </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FILTER_LIST'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># (in $LEPHAREDIR/filt/*)</span>
<span class="s1">        TRANS_TYPE </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'TRANS_TYPE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># TRANSMISSION TYPE</span>
<span class="s1">        FILTER_CALIB </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FILTER_CALIB'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># 0[-def]: fnu=ctt, 1: nu.fnu=ctt, 2: fnu=nu, 3: fnu=Black Body @ T=10000K, 4: for MIPS (leff with nu fnu=ctt and flux with BB @ 10000K</span>
<span class="s1">        FILTER_FILE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FILTER_FILE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># output name of filter's file -&gt; $LEPHAREWORK/filt/</span>
<span class="s1">        #</span>
<span class="s1">        ############################################################################</span>
<span class="s1">        #                 THEORETICAL  MAGNITUDES                                  #</span>
<span class="s1">        # $LEPHAREDIR/source/mag_star -c  $LEPHAREDIR/config/zphot.para (star only)#</span>
<span class="s1">        # help: $LEPHAREDIR/source/mag_star -h (or -help)                          #</span>
<span class="s1">        # $LEPHAREDIR/source/mag_gal  -t (Q or G) -c $LEPHAREDIR/config/zphot.para #</span>
<span class="s1">        #                                                         (for gal. &amp; QSO) #</span>
<span class="s1">        # help: $LEPHAREDIR/source/mag_gal  -h (or -help)                          #</span>
<span class="s1">        ############################################################################</span>
<span class="s1">        #</span>
<span class="s1">        #-------     From STELLAR LIBRARY</span>
<span class="s1">        #</span>
<span class="s1">        STAR_LIB_IN </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'STAR_LIB_IN'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Input STELLAR LIBRARY in $LEPHAREWORK/lib_bin/</span>
<span class="s1">        STAR_LIB_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'STAR_LIB_OUT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Output STELLAR MAGN -&gt; $LEPHAREWORK/lib_mag/</span>
<span class="s1">        #</span>
<span class="s1">        #-------     From QSO     LIBRARY   </span>
<span class="s1">        #</span>
<span class="s1">        QSO_LIB_IN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'QSO_LIB_IN'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Input QSO LIBRARY in $LEPHAREWORK/lib_bin/</span>
<span class="s1">        QSO_LIB_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'QSO_LIB_OUT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Output QSO MAGN -&gt; $LEPHAREWORK/lib_mag/</span>
<span class="s1">        #</span>
<span class="s1">        #-------     From GALAXY  LIBRARY  </span>
<span class="s1">        #</span>
<span class="s1">        GAL_LIB_IN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'GAL_LIB_IN'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Input GAL LIBRARY in $LEPHAREWORK/lib_bin/</span>
<span class="s1">        GAL_LIB_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'GAL_LIB_OUT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Output GAL LIBRARY -&gt; $LEPHAREWORK/lib_mag/ </span>
<span class="s1">        #</span>
<span class="s1">        #-------   MAG + Z_STEP + EXTINCTION + COSMOLOGY</span>
<span class="s1">        #</span>
<span class="s1">        MAGTYPE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MAGTYPE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Magnitude type (AB or VEGA)</span>
<span class="s1">        Z_STEP </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'Z_STEP'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># dz, zmax, dzsup(if zmax&gt;6)</span>
<span class="s1">        COSMOLOGY </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'COSMOLOGY'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># H0,om0,lbd0 (if lb0&gt;0-&gt;om0+lbd0=1)</span>
<span class="s1">        MOD_EXTINC </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MOD_EXTINC'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1"># model range for extinction </span>
<span class="s1">        EXTINC_LAW </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'EXTINC_LAW'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># ext. law (in $LEPHAREDIR/ext/*)</span>
<span class="s1">        EB_V </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'EB_V'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># E(B-V) (&lt;50 values)</span>
<span class="s1">        EM_LINES </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'EM_LINES'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        # Z_FORM 	8,7,6,5,4,3 	# Zformation for each SED in GAL_LIB_IN</span>
<span class="s1">        #</span>
<span class="s1">        #-------   ASCII OUTPUT FILES OPTION</span>
<span class="s1">        #</span>
<span class="s1">        LIB_ASCII </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'LIB_ASCII'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Writes output in ASCII in working directory</span>
<span class="s1">        #</span>
<span class="s1">        ############################################################################</span>
<span class="s1">        #              PHOTOMETRIC REDSHIFTS                                       #</span>
<span class="s1">        # $LEPHAREDIR/source/zphot -c $LEPHAREDIR/config/zphot.para                #</span>
<span class="s1">        # help: $LEPHAREDIR/source/zphot -h (or -help)                             #</span>
<span class="s1">        ############################################################################ </span>
<span class="s1">        #</span>
<span class="s1">        %INPUTCATALOGUEINFORMATION%</span>
<span class="s1">        CAT_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">.out </span><span class="se">\t</span><span class="s1"></span>
<span class="s1">        PARA_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outputParamFile</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Ouput parameter (full path)</span>
<span class="s1">        BD_SCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'BD_SCALE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Bands used for scaling (Sum 2^n; n=0-&gt;nbd-1, 0[-def]:all bands)</span>
<span class="s1">        GLB_CONTEXT</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'GLB_CONTEXT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Overwrite Context (Sum 2^n; n=0-&gt;nbd-1, 0 : all bands used, -1[-def]: used context per object)</span>
<span class="s1">        # FORB_CONTEXT -1               # context for forbitten bands</span>
<span class="s1">        ERR_SCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ERR_SCALE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># errors per band added in quadrature</span>
<span class="s1">        ERR_FACTOR </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ERR_FACTOR'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># error scaling factor 1.0 [-def]       </span>
<span class="s1">        #</span>
<span class="s1">        #-------    Theoretical libraries</span>
<span class="s1">        #</span>
<span class="s1">        ZPHOTLIB </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ZPHOTLIB'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Library used for Chi2 (max:3)</span>
<span class="s1">        ADD_EMLINES</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ADD_EMLINES'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        #</span>
<span class="s1">        ########    PHOTOMETRIC REDSHIFTS OPTIONS      ###########</span>
<span class="s1">        #</span>
<span class="s1">        # FIR LIBRARY</span>
<span class="s1">        #</span>
<span class="s1">        FIR_LIB </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FIR_LIB'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        FIR_LMIN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FIR_LMIN'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Lambda Min (micron) for FIR analysis </span>
<span class="s1">        FIR_CONT </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FIR_CONT'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        FIR_SCALE </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FIR_SCALE'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        FIR_FREESCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FIR_FREESCALE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># ALLOW FOR FREE SCALING </span>
<span class="s1">        FIR_SUBSTELLAR </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FIR_SUBSTELLAR'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        #</span>
<span class="s1">        # PHYSICAL LIBRARY with Stochastic models from  BC07  </span>
<span class="s1">        #</span>
<span class="s1">        PHYS_LIB </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'PHYS_LIB'</span><span class="p">]</span><span class="si">}</span><span class="s1">  </span>
<span class="s1">        PHYS_CONT </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'PHYS_CONT'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        PHYS_SCALE </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'PHYS_SCALE'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        PHYS_NMAX </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'PHYS_NMAX'</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        #</span>
<span class="s1">        #-------     Priors  </span>
<span class="s1">        #</span>
<span class="s1">        # MASS_SCALE	0.,0.		# Lg(Scaling) min,max [0,0-def]</span>
<span class="s1">        MAG_ABS </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MAG_ABS'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Mabs_min, Mabs_max [0,0-def]</span>
<span class="s1">        MAG_REF </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MAG_REF'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Reference number for band used by Mag_abs</span>
<span class="s1">        # ZFORM_MIN	5,5,5,5,5,5,3,1	# Min. Zformation per SED -&gt; Age constraint</span>
<span class="s1">        Z_RANGE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'Z_RANGE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Z min-max used for the Galaxy library </span>
<span class="s1">        EBV_RANGE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'EBV_RANGE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># E(B-V) MIN-MAX RANGE of E(B-V) used  </span>
<span class="s1">        # NZ_PRIOR      4,2,4           # I Band for prior on N(z)</span>
<span class="s1">        #                          </span>
<span class="s1">        #-------     Fixed Z   (need format LONG for input Cat)</span>
<span class="s1">        #</span>
<span class="s1">        ZFIX </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ZFIX'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># fixed z and search best model [YES,NO-def]</span>
<span class="s1">        #</span>
<span class="s1">        #-------     Parabolic interpolation for Zbest  </span>
<span class="s1">        #</span>
<span class="s1">        Z_INTERP </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'Z_INTERP'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># redshift interpolation [YES,NO-def]</span>
<span class="s1">        #</span>
<span class="s1">        #-------  Analysis of normalized ML(exp-(0.5*Chi^2)) curve </span>
<span class="s1">        #-------  Secondary peak analysis       </span>
<span class="s1">        #</span>
<span class="s1">        DZ_WIN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'DZ_WIN'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Window search for 2nd peaks [0-&gt;5;0.25-def]</span>
<span class="s1">        MIN_THRES </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MIN_THRES'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Lower threshold for 2nd peaks[0-&gt;1; 0.1-def]</span>
<span class="s1">        #</span>
<span class="s1">        #-------  Probability (in %) per redshift intervals</span>
<span class="s1">        #</span>
<span class="s1">        # PROB_INTZ     0,0.5,0.5,1.,1.,1.5     # even number</span>
<span class="s1">        #</span>
<span class="s1">        #########    ABSOLUTE MAGNITUDES COMPUTATION   ###########</span>
<span class="s1">        #</span>
<span class="s1">        MABS_METHOD </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MABS_METHOD'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># 0[-def] : obs-&gt;Ref, 1 : best  obs-&gt;Ref, 2 : fixed obs-&gt;Ref, 3 : mag from best SED, 4 : Zbin</span>
<span class="s1">        MABS_CONTEXT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MABS_CONTEXT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># CONTEXT for Band used for MABS </span>
<span class="s1">        MABS_REF </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MABS_REF'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># 0[-def]: filter obs chosen for Mabs (ONLY USED IF MABS_METHOD=2)</span>
<span class="s1">        MABS_FILT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MABS_FILT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Chosen filters per redshift bin (MABS_ZBIN - ONLY USED IF MABS_METHOD=4)</span>
<span class="s1">        MABS_ZBIN </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'MABS_ZBIN'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Redshift bins (even number - ONLY USED IF MABS_METHOD=4)</span>
<span class="s1">        #</span>
<span class="s1">        #########   OUTPUT SPECTRA                     ###########</span>
<span class="s1">        #</span>
<span class="s1">        SPEC_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'SPEC_OUT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1"># spectrum for each object? [YES,NO-def]</span>
<span class="s1">        CHI2_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'CHI2_OUT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1"># output file with all values : z,mod,chi2,E(B-V),... BE CAREFUL can take a lot of space !!</span>
<span class="s1">        #</span>
<span class="s1">        #########  OUTPUT PDZ ANALYSIS  </span>
<span class="s1">        #</span>
<span class="s1">        PDZ_OUT </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'PDZ_OUT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># pdz output file name [def-NONE] - add automatically PDZ_OUT[.pdz/.mabsx/.mod/.zph] </span>
<span class="s1">        PDZ_MABS_FILT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'PDZ_MABS_FILT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># MABS for REF FILTERS to be extracted</span>
<span class="s1">        # </span>
<span class="s1">        #########   FAST MODE : color-space reduction        #####</span>
<span class="s1">        #</span>
<span class="s1">        FAST_MODE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'FAST_MODE'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Fast computation [NO-def] </span>
<span class="s1">        COL_NUM	</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'COL_NUM'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Number of colors used [3-def]</span>
<span class="s1">        COL_SIGMA </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'COL_SIGMA'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Enlarge of the obs. color-errors[3-def]</span>
<span class="s1">        COL_SEL </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'COL_SEL'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Combination between used colors [AND/OR-def]</span>
<span class="s1">        #</span>
<span class="s1">        #########   MAGNITUDE SHIFTS applied to libraries   ######</span>
<span class="s1">        #</span>
<span class="s1">        # APPLY_SYSSHIFT  0.             # Apply systematic shifts in each band</span>
<span class="s1">                                         # used only if number of shifts matches</span>
<span class="s1">                                         # with number of filters in the library    </span>
<span class="s1">        #</span>
<span class="s1">        #########   ADAPTIVE METHOD using Z spectro sample     ###</span>
<span class="s1">        #</span>
<span class="s1">        AUTO_ADAPT </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'AUTO_ADAPT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Adapting method with spectro [NO-def]</span>
<span class="s1">        ADAPT_BAND </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ADAPT_BAND'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Reference band, band1, band2 for color </span>
<span class="s1">        ADAPT_LIM </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ADAPT_LIM'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Mag limits for spectro in Ref band [18,21.5-def]</span>
<span class="s1">        ADAPT_POLY </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ADAPT_POLY'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Number of coef in  polynom (max=4) [1-def]</span>
<span class="s1">        ADAPT_METH </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ADAPT_METH'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Fit as a function of 1 : Color Model  [1-def], 2 : Redshift, 3 : Models</span>
<span class="s1">        ADAPT_CONTEXT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ADAPT_CONTEXT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Context for bands used for training, -1[-def] used context per object</span>
<span class="s1">        ADAPT_ZBIN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ADAPT_ZBIN'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Redshift's interval used for training [0.001,6-Def]</span>
<span class="s1">        ADAPT_MODBIN </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ADAPT_MODBIN'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Model's interval used for training [1,1000-Def]</span>
<span class="s1">        ERROR_ADAPT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">'ERROR_ADAPT'</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># [YES,NO-def] Add error in quadrature according to the difference between observed and predicted apparent magnitudes </span>
<span class="s1">        #</span>
<span class="s1">        '''</span>      
        
        <span class="k">return</span> <span class="n">text</span>
    
    <span class="c1">#############################</span>
    <span class="c1">#        Run methods        #</span>
    <span class="c1">#############################</span>
    
<div class="viewcode-block" id="LePhareSED.runScript"><a class="viewcode-back" href="../../API/sed.html#SED.sed.LePhareSED.runScript">[docs]</a>    <span class="k">def</span> <span class="nf">runScript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span> <span class="n">TextIOBase</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Wrapper around default :py:meth:`~.SED.startProcess` which allows to separately provide the commands and the file.</span>
<span class="sd">        </span>
<span class="sd">        :param commands: list of commands to use with Popen</span>
<span class="sd">        :type commands: :python:`list[str]`</span>
<span class="sd">        </span>
<span class="sd">        :param file: (**Optional**) file to run the process or script against</span>
<span class="sd">        :type file: :python:`str`</span>
<span class="sd">        :param log: (**Optional**) oppened log file</span>
<span class="sd">        :type log: `TextIOBase`_</span>
<span class="sd">        :param errMsg: (**Optional**) message error to show if the process failed</span>
<span class="sd">        :type errMsg: :python:`str`</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'commands parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type list.'</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'XXX:'</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">startProcess</span><span class="p">(</span><span class="n">commands</span> <span class="o">+</span> <span class="p">[</span><span class="n">file</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">errMsg</span><span class="o">=</span><span class="n">errMsg</span><span class="p">)</span></div>
    
    <span class="n">genQSOModel</span>  <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$LEPHAREDIR/source/sedtolib'</span><span class="p">,</span> <span class="s1">'-t'</span><span class="p">,</span> <span class="s1">'QSO'</span><span class="p">,</span>     <span class="s1">'-c'</span><span class="p">],</span> <span class="n">errMsg</span><span class="o">=</span><span class="s1">'QSO models generation failed.'</span><span class="p">)</span>
    <span class="n">genGalModel</span>  <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$LEPHAREDIR/source/sedtolib'</span><span class="p">,</span> <span class="s1">'-t'</span><span class="p">,</span> <span class="s1">'Galaxy'</span><span class="p">,</span>  <span class="s1">'-c'</span><span class="p">],</span> <span class="n">errMsg</span><span class="o">=</span><span class="s1">'Galaxy models generation failed.'</span><span class="p">)</span>
    <span class="n">genStarModel</span> <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$LEPHAREDIR/source/sedtolib'</span><span class="p">,</span> <span class="s1">'-t'</span><span class="p">,</span> <span class="s1">'Stellar'</span><span class="p">,</span> <span class="s1">'-c'</span><span class="p">],</span> <span class="n">errMsg</span><span class="o">=</span><span class="s1">'Stellar models generation failed.'</span><span class="p">)</span>
    <span class="n">genFilters</span>   <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$LEPHAREDIR/source/filter'</span><span class="p">,</span> <span class="s1">'-c'</span><span class="p">],</span>                    <span class="n">errMsg</span><span class="o">=</span><span class="s1">'Filters generation failed.'</span><span class="p">)</span>
    <span class="n">genMagQSO</span>    <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$LEPHAREDIR/source/mag_gal'</span><span class="p">,</span> <span class="s1">'-t'</span><span class="p">,</span> <span class="s1">'Q'</span><span class="p">,</span> <span class="s1">'-c'</span><span class="p">],</span>        <span class="n">errMsg</span><span class="o">=</span><span class="s1">'QSO magnitudes failed.'</span><span class="p">)</span>
    <span class="n">genMagStar</span>   <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$LEPHAREDIR/source/mag_star'</span><span class="p">,</span> <span class="s1">'-c'</span><span class="p">],</span>                  <span class="n">errMsg</span><span class="o">=</span><span class="s1">'Stellar magnitudes failed.'</span><span class="p">)</span>
    <span class="n">genMagGal</span>    <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$LEPHAREDIR/source/mag_gal'</span><span class="p">,</span> <span class="s1">'-t'</span><span class="p">,</span> <span class="s1">'G'</span><span class="p">,</span> <span class="s1">'-c'</span><span class="p">],</span>        <span class="n">errMsg</span><span class="o">=</span><span class="s1">'Galaxy magnitudes failed.'</span><span class="p">)</span>
    <span class="n">startLePhare</span> <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$LEPHAREDIR/source/zphota'</span><span class="p">,</span> <span class="s1">'-c'</span><span class="p">],</span>                    <span class="n">errMsg</span><span class="o">=</span><span class="s1">'SED fitting failed.'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catalogue</span><span class="p">:</span> <span class="n">LePhareCat</span><span class="p">,</span> 
                 <span class="n">outputParams</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> 
                 <span class="n">skipSEDgen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="n">skipFilterGen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="n">skipMagQSO</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="n">skipMagStar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="n">skipMagGal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LePhareOutput</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">        </span>
<span class="sd">        Start the SED fitting on the given data using the built-in SED fitting parameters.</span>
<span class="sd">        </span>
<span class="sd">        :param LePhareCat catalogue: catalogue to use for the SED-fitting</span>
<span class="sd">        </span>
<span class="sd">        :param outputParams: (**Optional**) output parameters</span>
<span class="sd">        :type outputParams: :python:`list[str]`</span>
<span class="sd">        :param skipSEDgen: (**Optional**) whether to skip the SED models generation. Useful to gain time if the same SED are used for multiple sources.</span>
<span class="sd">        :type skipSEDgen: :python:`bool`</span>
<span class="sd">        :param skipFilterGen: (**Optional**) whether to skip the filters generation. Useful to gain time if the same filters are used for multiple sources.</span>
<span class="sd">        :type skipFilterGen: :python:`bool`</span>
<span class="sd">        :param skipMagQSO: (**Optional**) whether to skip the predicted magnitude computations for the QS0. Useful to gain time if the same libraries/parameters are used for multiple sources.</span>
<span class="sd">        :type skipMagQSO: :python:`bool`</span>
<span class="sd">        :param skipMagStar: (**Optional**) whether to skip the predicted magnitude computations for the stars. Useful to gain time if the same libraries/parameters are used for multiple sources.</span>
<span class="sd">        :type skipMagStar: :python`bool`</span>
<span class="sd">        :param skipMagGal: (**Optional**) whether to skip the predicted magnitude computations for the galaxies. Useful to gain time if the same libraries/parameters are used for multiple sources.</span>
<span class="sd">        :type skipMagGal: :python:`bool`</span>

<span class="sd">        :returns: LePhare output file object with data from the file loaded</span>
<span class="sd">        :rtype: LePhareOutput</span>

<span class="sd">        :raises TypeError: if **catalogue** is not of type :py:class:`~.LePhareCat`</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">catalogue</span><span class="p">,</span> <span class="n">LePhareCat</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'catalogue has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">catalogue</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a LePhareCat instance.'</span><span class="p">)</span>
        
        <span class="c1"># Make output directory</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">'</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            
        <span class="c1"># Different SED fitting output file names</span>
        <span class="n">paramFile</span> <span class="o">=</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.in'</span><span class="p">,</span> <span class="s1">'.para'</span><span class="p">)</span>
        <span class="n">pfile</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">paramFile</span><span class="p">)</span>
        <span class="n">logFile</span>   <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.in'</span><span class="p">,</span> <span class="s1">'_lephare.log'</span><span class="p">))</span>
        <span class="n">oCatFile</span>  <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.in'</span><span class="p">,</span> <span class="s1">'.out'</span><span class="p">))</span>
        
        <span class="c1"># Generate and write parameters file</span>
        <span class="n">params</span>    <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'%INPUTCATALOGUEINFORMATION%'</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            
        <span class="c1"># Write catalogue</span>
        <span class="n">catalogue</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
        
        <span class="c1"># Generate and write output parameters file</span>
        <span class="n">oparams</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_parameters</span><span class="p">(</span><span class="n">outputParams</span><span class="p">)</span>
        <span class="n">ofile</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputParamFile</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">oparams</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logFile</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>

            <span class="c1">#########################################</span>
            <span class="c1">#          Generate SED models          #</span>
            <span class="c1">#########################################</span>
            
            <span class="c1"># Generate QSO, Star and Galaxy models</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipSEDgen</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genQSOModel</span><span class="p">(</span> <span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genStarModel</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genGalModel</span><span class="p">(</span> <span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                
            <span class="c1">####################################</span>
            <span class="c1">#         Generate filters         #</span>
            <span class="c1">####################################</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipFilterGen</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genFilters</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            
            <span class="c1">##############################################</span>
            <span class="c1">#        Compute predicted magnitudes        #</span>
            <span class="c1">##############################################</span>
            
            <span class="c1"># QSO magnitudes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipMagQSO</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genMagQSO</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                
            <span class="c1"># Star magnitudes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipMagStar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genMagStar</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                    
            <span class="c1"># Galaxy magnitudes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipMagGal</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genMagGal</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            
            <span class="c1">###################################</span>
            <span class="c1">#         Run SED fitting         #</span>
            <span class="c1">###################################</span>
            
            <span class="c1"># Move to directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">startLePhare</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">paramFile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            
            <span class="c1"># Move back to parent directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'..'</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">LePhareOutput</span><span class="p">(</span><span class="n">oCatFile</span><span class="p">)</span> </div>
 
</code></pre></div>
</article>
<footer>
<div class="mt-20 mb-4 text-sm text-gray-700">© 2021, Wilfried Mercier Made with <a href="https://www.sphinx-doc.org">Sphinx 4.4.0</a></div>
</footer></main>
<button class="fixed bottom-0 right-0 z-20 opacity-0 p-4 m-4 tracking-wide bg-gray-900 text-gray-100 transition transform transform-gpu duration-500 translate-y-full" data-action="search#hideSnackbar" data-search-target="snackbar">
  Clear highlights
</button><div class="fixed hidden inset-0 bg-black bg-opacity-50" data-action="click-&gt;sidebar#close" data-sidebar-target="screen">
</div>
</div>
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/theme.3666d2347a4c66e5d7a8.js"></script>
</body>
</html>